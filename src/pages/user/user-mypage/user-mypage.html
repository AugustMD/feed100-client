<!--
  Generated template for the UserMypagePage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header class="tabs-header">
  <ion-navbar hideBackButton="true">
    <ion-buttons start>
      <button class="badge-button-wrapper" ion-button clear (click)="openUserAlarmPage()">
        <ion-icon name="notifications">
          <ion-badge class="badge-button-wrapper-badge" color="danger" *ngIf="getAlarmNum()>0">{{getAlarmNum()}}</ion-badge>
        </ion-icon>              
      </button>
    </ion-buttons>
    <ion-title>마이페이지</ion-title>
    <ion-buttons end>
      <button ion-button (click)="openUserConfigurePage()">
        <ion-icon name="settings"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>
<ion-content>
  <ion-refresher padding-top (ionRefresh)="doRefresh($event)" pullMin="150" pullMax="500">
      <ion-refresher-content>
      </ion-refresher-content>
  </ion-refresher>      
  <ion-item margin-top class="mypage-profile-wrapper avatar-span-wrapper item-flex">
    <span item-start class="avatar-image avatar-span cropper">
       <img class="avatar-span-image" [src]="avatarImage" />
    </span>
    <p>Lv{{level}}  {{levelClass}}</p>
    <h5>
      {{nickname}}
      <button class="account-modification-button" ion-button clear (click)="openUserAccountModificationFormPage()">
        <ion-icon name="md-create"></ion-icon>
      </button>
    </h5>
    <p>{{point}} 포인트</p>
    <button margin-top class="profile-modification-button" ion-button outline block (click)="openUserProfileModificationFormPage()">프로필 수정</button>
  </ion-item>
  <div margin-top class="exp-wrapper">
    <span margin-left float-left>경험치</span>
    <span margin-right float-right>{{exp}}/{{maxExp}} ({{expPercent}}%)</span>
  </div>
  <progress-bar [progress]="expPercent"></progress-bar>

  <ion-segment class="segment-button-wrapper" [(ngModel)]="segmentProjectCondition">
    <ion-segment-button value="proceedingProject" isActive="true">
      <p>{{proceedingProjectNum}}</p>
      <h5>참여중인 프로젝트</h5>
    </ion-segment-button>
    <ion-segment-button value="rewardProject">
      <p>{{rewardProjectNum}}</p>
      <h5>보상받을 프로젝트</h5>
    </ion-segment-button>
    <ion-segment-button value="endProject">
      <p>{{endProjectNum}}</p>
      <h5>종료된 프로젝트</h5>
    </ion-segment-button>
  </ion-segment>

  <div [ngSwitch]="segmentProjectCondition">
    <div class="outer-content" *ngSwitchCase="'proceedingProject'">
      <div text-center *ngIf = "!proceedingProjects.length" class="empty-inner white-bg">
        <p>참여중인 프로젝트가 없습니다!</p>
        <button ion-button clear (click)="openUserProjectPage()">프로젝트 둘러보러 가기 ></button>
      </div>
      <ion-grid *ngIf="proceedingProjects.length">
        <ion-row>
          <div tappable *ngFor="let proceedingProject of proceedingProjects" class="project-card card-div" (click)="accessProjectCard(proceedingProject.project_id)">
            <div class="project-card-main-image-wrapper">
              <img [src]="proceedingProject.project_main_image" />
              <div class="project-card-overlay-wrapper">
                <span class="project-card-overlay">
                  <span class="project-card-overlay-item e-card-tag" *ngIf="(proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) == '종료'">종&ensp;료</span>
                  <span class="project-card-overlay-item m-card-tag" *ngIf="((proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && (proceedingProject.is_my_project)">참&ensp;여</span>
                  <span class="project-card-overlay-item f-card-tag" *ngIf="((proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && !(proceedingProject.is_my_project) && (proceedingProject.max_participant_num == proceedingProject.participant_num)">FULL</span>
                  <span class="project-card-overlay-item i-card-tag" *ngIf="((proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && !(proceedingProject.is_my_project) && (proceedingProject.max_participant_num != proceedingProject.participant_num) && (((proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | slice:-4:-2) == '시간') || ((proceedingProject.max_participant_num - proceedingProject.participant_num) <= (proceedingProject.max_participant_num/10)))">임&ensp;박</span>
                  <span class="project-card-overlay-item p-card-tag" *ngIf="((proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && !(proceedingProject.is_my_project) && (proceedingProject.max_participant_num != proceedingProject.participant_num) && !(((proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | slice:-4:-2) == '시간') || ((proceedingProject.max_participant_num - proceedingProject.participant_num) <= (proceedingProject.max_participant_num/10)))">진&ensp;행</span>
                </span>
              </div>
              <div class="project-card-overlay-wrapper card-overlay-bottom"></div>
            </div>
            <div text-left class="card-content">
              <p class="project-card-summary"><b class="project-card-name">{{proceedingProject.project_name}}</b><br><br>{{proceedingProject.project_summary}}</p>
              <progress-bar *ngIf="((proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료')" [progress]="proceedingProject.participant_num | divide : proceedingProject.max_participant_num"></progress-bar>
              <progress-bar *ngIf="((proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) == '종료')" progress="100" class="dark-progress-bar"></progress-bar>
              <div *ngIf="(proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료'" class="project-state-wrapper">
                <span class="project-state-icon">
                  <img src="assets/img/calendar.png" />
                </span>
                <span class="project-state-content">
                  {{proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState}}
                </span>
                <span margin-left class="project-state-icon">
                  <img src="assets/img/people.png" />
                </span>
                <span class="project-state-content">
                  <b *ngIf="(proceedingProject.max_participant_num - proceedingProject.participant_num) == 0">FULL</b>
                  <b *ngIf="(proceedingProject.max_participant_num - proceedingProject.participant_num) != 0">{{proceedingProject.max_participant_num - proceedingProject.participant_num}}명 참여 가능</b>
                </span>
              </div>
              <div *ngIf="(proceedingProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) == '종료'" class="project-state-wrapper">
                <span class="project-state-content">
                  <b class="end-text">프로젝트가 종료되었습니다.</b>
                </span>
              </div>
            </div>
          </div>
        </ion-row>
      </ion-grid>
    </div>

    <div class="outer-content" *ngSwitchCase="'rewardProject'">
      <div text-center *ngIf = "!rewardProjects.length" class="empty-inner white-bg">
        <p>보상받을 프로젝트가 없습니다!</p>
        <button ion-button clear (click)="openUserProjectPage()">프로젝트 둘러보러 가기 ></button>
      </div>
      <ion-grid *ngIf="rewardProjects.length">
        <ion-row>
          <div tappable *ngFor="let rewardProject of rewardProjects" class="project-card card-div" (click)="accessProjectCard(rewardProject.project_id)">
            <div class="project-card-main-image-wrapper">
              <img [src]="rewardProject.project_main_image" />
              <div class="project-card-overlay-wrapper">
                <span class="project-card-overlay">
                  <span class="project-card-overlay-item e-card-tag" *ngIf="(rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) == '종료'">종&ensp;료</span>
                  <span class="project-card-overlay-item m-card-tag" *ngIf="((rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && (rewardProject.is_my_project)">참&ensp;여</span>
                  <span class="project-card-overlay-item f-card-tag" *ngIf="((rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && !(rewardProject.is_my_project) && (rewardProject.max_participant_num == rewardProject.participant_num)">FULL</span>
                  <span class="project-card-overlay-item i-card-tag" *ngIf="((rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && !(rewardProject.is_my_project) && (rewardProject.max_participant_num != rewardProject.participant_num) && (((rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | slice:-4:-2) == '시간') || ((rewardProject.max_participant_num - rewardProject.participant_num) <= (rewardProject.max_participant_num/10)))">임&ensp;박</span>
                  <span class="project-card-overlay-item p-card-tag" *ngIf="((rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && !(rewardProject.is_my_project) && (rewardProject.max_participant_num != rewardProject.participant_num) && !(((rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | slice:-4:-2) == '시간') || ((rewardProject.max_participant_num - rewardProject.participant_num) <= (rewardProject.max_participant_num/10)))">진&ensp;행</span>
                </span>
              </div>
              <div class="project-card-overlay-wrapper card-overlay-bottom"></div>
            </div>
            <div text-left class="card-content">
              <p class="project-card-summary"><b class="project-card-name">{{rewardProject.project_name}}</b><br><br>{{rewardProject.project_summary}}</p>
              <progress-bar *ngIf="((rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료')" [progress]="rewardProject.participant_num | divide : rewardProject.max_participant_num"></progress-bar>
              <progress-bar *ngIf="((rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) == '종료')" progress="100" class="dark-progress-bar"></progress-bar>
              <div *ngIf="(rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료'" class="project-state-wrapper">
                <span class="project-state-icon">
                  <img src="assets/img/calendar.png" />
                </span>
                <span class="project-state-content">
                  {{rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState}}
                </span>
                <span margin-left class="project-state-icon">
                  <img src="assets/img/people.png" />
                </span>
                <span class="project-state-content">
                  <b *ngIf="(rewardProject.max_participant_num - rewardProject.participant_num) == 0">FULL</b>
                  <b *ngIf="(rewardProject.max_participant_num - rewardProject.participant_num) != 0">{{rewardProject.max_participant_num - rewardProject.participant_num}}명 참여 가능</b>
                </span>
              </div>
              <div *ngIf="(rewardProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) == '종료'" class="project-state-wrapper">
                <span class="project-state-content">
                  <b class="end-text">프로젝트가 종료되었습니다.</b>
                </span>
              </div>
            </div>
          </div>
        </ion-row>
      </ion-grid>
    </div>

    <div class="outer-content" *ngSwitchCase="'endProject'">
      <div text-center *ngIf = "!endProjects.length" class="empty-inner white-bg">
        <p>종료된 프로젝트가 없습니다!</p>
        <button ion-button clear (click)="openUserProjectPage()">프로젝트 둘러보러 가기 ></button>
      </div>
      <ion-grid *ngIf="endProjects.length">
        <ion-row>
          <div tappable *ngFor="let endProject of endProjects" class="project-card card-div" (click)="accessProjectCard(endProject.project_id)">
            <div class="project-card-main-image-wrapper">
              <img [src]="endProject.project_main_image" />
              <div class="project-card-overlay-wrapper">
                <span class="project-card-overlay">
                  <span class="project-card-overlay-item e-card-tag" *ngIf="(endProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) == '종료'">종&ensp;료</span>
                  <span class="project-card-overlay-item m-card-tag" *ngIf="((endProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && (endProject.is_my_project)">참&ensp;여</span>
                  <span class="project-card-overlay-item f-card-tag" *ngIf="((endProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && !(endProject.is_my_project) && (endProject.max_participant_num == endProject.participant_num)">FULL</span>
                  <span class="project-card-overlay-item i-card-tag" *ngIf="((endProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && !(endProject.is_my_project) && (endProject.max_participant_num != endProject.participant_num) && (((endProject.project_end_date | amLocale:'ko' | amTimeAgo | slice:-4:-2) == '시간') || ((endProject.max_participant_num - endProject.participant_num) <= (endProject.max_participant_num/10)))">임&ensp;박</span>
                  <span class="project-card-overlay-item p-card-tag" *ngIf="((endProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료') && !(endProject.is_my_project) && (endProject.max_participant_num != endProject.participant_num) && !(((endProject.project_end_date | amLocale:'ko' | amTimeAgo | slice:-4:-2) == '시간') || ((endProject.max_participant_num - endProject.participant_num) <= (endProject.max_participant_num/10)))">진&ensp;행</span>
                </span>
              </div>
              <div class="project-card-overlay-wrapper card-overlay-bottom"></div>
            </div>
            <div text-left class="card-content">
              <p class="project-card-summary"><b class="project-card-name">{{endProject.project_name}}</b><br><br>{{endProject.project_summary}}</p>
              <progress-bar *ngIf="((endProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료')" [progress]="endProject.participant_num | divide : endProject.max_participant_num"></progress-bar>
              <progress-bar *ngIf="((endProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) == '종료')" progress="100" class="dark-progress-bar"></progress-bar>
              <div *ngIf="(endProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) != '종료'" class="project-state-wrapper">
                <span class="project-state-icon">
                  <img src="assets/img/calendar.png" />
                </span>
                <span class="project-state-content">
                  {{endProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState}}
                </span>
                <span margin-left class="project-state-icon">
                  <img src="assets/img/people.png" />
                </span>
                <span class="project-state-content">
                  <b *ngIf="(endProject.max_participant_num - endProject.participant_num) == 0">FULL</b>
                  <b *ngIf="(endProject.max_participant_num - endProject.participant_num) != 0">{{endProject.max_participant_num - endProject.participant_num}}명 참여 가능</b>
                </span>
              </div>
              <div *ngIf="(endProject.project_end_date | amLocale:'ko' | amTimeAgo | progressState) == '종료'" class="project-state-wrapper">
                <span class="project-state-content">
                  <b class="end-text">프로젝트가 종료되었습니다.</b>
                </span>
              </div>
            </div>
          </div>
        </ion-row>
      </ion-grid> 
    </div>
  </div>
</ion-content>