<!--
  Generated template for the UserProjectHomePage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->

<ion-header class="project-header-wrapper">
  <ion-navbar hideBackButton="true">
    <ion-buttons start>
      <!-- <button class="dismiss-button" ion-button (click)="dismiss()" icon-only> -->
      <button ion-button (click)="back()" icon-only>
        <ion-icon name="ios-arrow-back"></ion-icon>              
      </button>
    </ion-buttons>
    <ion-title>
      <!-- <span class="project-header-title-wrapper">
        <span class="project-header-title">
          {{projectName | slice:0:15}}
        </span>
        <span class="slice-tag" *ngIf="projectName.length > 15"> ...</span>
      </span> -->
      <ion-item class="avatar-span-wrapper item-flex">
        <span item-start class="avatar-image avatar-span cropper">
          <img class="avatar-span-image" [src]="avatarImage" />
        </span>
        <h3>{{nickname}}</h3>
        <h5>{{projectRegistrationDate | amDateFormat: 'YYYY-MM-DD'}} 에 작성됨</h5>
      </ion-item>
    </ion-title>
    <ion-buttons end> 
      <button class="menu-button" ion-button icon-only (click)="openUserProjectSideMenuPage()">
        <ion-icon name="menu"></ion-icon>
      </button>
     </ion-buttons> 
  </ion-navbar>
</ion-header>

<ion-content class="project-home-content-wrapper" #contentRef>
  <div tappable class="project-card-main-image-wrapper" (click)="openUserProjectStoryPage()">
    <!-- <div class="shadow-header-top"></div> -->
    <img class="project-home-main-image" [src]="projectMainImage" />

    <div class="project-card-overlay-wrapper">
      <span text-center class="project-card-overlay">
        <span class="project-card-overlay-item">
          <ion-icon name="md-film"></ion-icon>스토리 보러가기
        </span>
      </span>
    </div>
  </div>
  <div class="project-home-content">
    <h1 [innerHTML]="projectName"></h1>
    <!-- <ion-item class="avatar-span-wrapper item-flex">
      <span item-start class="avatar-image avatar-span">
        <div class="avatar-span-image" [style.backgroundImage]="'url(' + avatarImage + ')'"></div>
      </span>
      <h3>{{nickname}}</h3>
    </ion-item> -->
    <p class="summary">{{projectSummary}}</p>
    <div class="participant-wrapper">
      <span>{{progressState | amLocale:'ko' | amTimeAgo | progressState}}</span>
      <span float-right>{{participantNum}} / {{maxParticipantNum}} <small>({{participantNum | divide : maxParticipantNum}}%)</small></span>
    </div>
    <progress-bar [progress]="participantNum | divide : maxParticipantNum"></progress-bar>
    <div *ngIf="isLink">
      <button class="open-link-button" ion-button (click)="openUserProjectLinkPage()">링크</button>
    </div>
    <div class="shadow-top"></div>
  </div>

  <div class="outer-content">
    <div class="feedbacks-header">
      <span class="header-name user-ui">피드백 {{participantNum}}</span>
      <!-- <button ion-button (click)="openUserProjectSearchPage()"><ion-icon name="search"></ion-icon>검색</button> -->
      <button ion-button class="feedback-list-button" (click)="openUserProjectFeedbackListPage()">토론하러 가기<ion-icon name="ios-arrow-forward"></ion-icon></button>
    </div>
    <div text-center *ngIf = "!feedbacks.length" class="empty-inner">
      <ion-icon name="text"></ion-icon>
      <p>아직 등록된 피드백이 없습니다.</p>
    </div>
    <ion-card class="feedback-card" *ngFor="let feedback of feedbacks"> 
      <ion-card-header>
        <ion-item class="avatar-span-wrapper item-flex">
          <span item-start class="avatar-image avatar-span cropper">
            <img class="avatar-span-image" [src]="feedback.avatar_image" />
          </span>
          <h3>
            <span class="best-badge" *ngIf="feedback.is_best">
              <span>BEST</span>
            </span>{{feedback.nickname}}
            <span float-right class="empathy-wrapper">
              <span><span class="text-empathy">공감</span> {{feedback.empathy_num}}</span>
              <span><span class="text-nonempathy">비공감</span> {{feedback.non_empathy_num}}</span>
            </span>
          </h3>
          <p [innerHTML]="feedback.project_feedback_registration_date | amLocale:'ko' | amTimeAgo"></p>
        </ion-item>
      </ion-card-header>
      <ion-card-content class="feedback-content">
        <div class="feedback-summary" tappable (click)="openUserProjectFeedbackPage(feedback.project_participant_id)">
          {{(feedback.project_feedback | jsonParse)[0] | slicetext:100  | replaceBrTag}}   
          <!-- <span class="slice-tag" *ngIf="(feedback.project_feedback | jsonParse)[0].length > 100"> ...</span>   -->
          <div class="feedback-more-button">피드백 자세히 보러가기 ></div>
        </div>
        <div class="hashtag-wrapper">
        <span tappable ion-button outline *ngFor="let feedbackHashtag of feedback.project_feedback_hashtags | jsonParse" (click)="openUserProjectSearchResultPage([feedbackHashtag])" >
          #{{feedbackHashtag}}
        </span> 
        </div>
      </ion-card-content>
    </ion-card>
  </div>
  <ion-fab right bottom>
    <button ion-fab><ion-icon name="add"></ion-icon></button>
    <ion-badge item-end *ngIf="interview_num > 0">{{interview_num}}</ion-badge>
    <ion-fab-list side="top">
      <button  (click)="openUserProjectReportFormPage()" ion-fab>
        <ion-icon color="light" name="ios-create"></ion-icon>
        <div class="fab-label fab-label-report">보고서를 작성해주세요!</div>
      </button> 
      <!-- <button class="disable-fab" *ngIf="limitFeedbackNum > participationFeedbackNum" ion-fab disabled>
        <ion-icon color="light" name="ios-create"></ion-icon>
        <div class="fab-label fab-label-report">{{limitFeedbackNum - participationFeedbackNum}}개 더 써야 작성가능합니다.</div>
      </button> -->
      <button ion-fab (click)="openUserProjectInterviewDetailPage()"><ion-icon color="light" name="text"></ion-icon></button>
      <ion-badge item-end *ngIf="interview_num > 0">{{interview_num}}</ion-badge>
    </ion-fab-list>
  </ion-fab>
</ion-content> 
