<!--
  Generated template for the CompanyProjectHomePage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header class="project-header-wrapper">
  <ion-navbar hideBackButton="true">
    <ion-buttons start>
      <button class="dismiss-button" ion-button (click)="dismiss()" icon-only>
        <ion-icon name="close"></ion-icon>              
      </button>
    </ion-buttons>
    <ion-title>
      <span class="project-header-title-wrapper">
        <span class="project-header-title">
          {{projectName | slice:0:15}}
        </span>
        <span class="slice-tag" *ngIf="projectName.length > 15"> ...</span>
      </span>
    </ion-title>
    <ion-buttons end> 
      <button class="menu-button" ion-button icon-only (click)="openCompanyProjectSideMenuPage()">
        <ion-icon name="menu"></ion-icon>
      </button>
     </ion-buttons> 
  </ion-navbar>
</ion-header>

<ion-content class="project-home-content-wrapper" #contentRef (ionScroll)="scrollingFun($event)" (ionScrollStart)="scrollingFun($event)">
  <div tappable class="project-card-main-image-wrapper" (click)="openCompanyProjectStoryPage()">
    <div class="shadow-header-top"></div>
    <img [src]="projectMainImage" />

    <div class="project-card-overlay-wrapper">
      <span text-center class="project-card-overlay">
        <span class="project-card-overlay-item">
          <ion-icon name="md-film"></ion-icon>스토리 보러가기
        </span>
      </span>
    </div>
  </div>
  <div class="project-home-content">
    <h1 [innerHTML]="projectName"></h1>
    <ion-item class="avatar-span-wrapper item-flex">
      <span item-start class="avatar-image avatar-span">
        <div class="avatar-span-image" [style.backgroundImage]="'url(' + avatarImage + ')'"></div>
      </span>
      <h3>{{nickname}}</h3>
    </ion-item>
    <p class="summary">{{projectSummary}}</p>
    <div class="participant-wrapper">
      <span>{{progressState | amLocale:'ko' | amTimeAgo | progressState}}</span>
      <span float-right>{{participantNum}} / {{maxParticipantNum}} <small>({{participantNum | divide : maxParticipantNum}}%)</small></span>
    </div>
    <progress-bar [progress]="participantNum | divide : maxParticipantNum"></progress-bar>
    <div *ngIf="isLink">
      <button class="open-link-button" ion-button (click)="openCompanyProjectLinkPage()">링크</button>
    </div>
    <div class="shadow-top"></div>
  </div>

  <div class="outer-content">
    <div class="feedbacks-header">
      <span class="header-name Company-ui">피드백 {{participantNum}}</span>
       <button ion-button (click)="openCompanyProjectSearchPage()"><ion-icon name="search"></ion-icon>검색</button> 
      <!-- <button ion-button class="feedback-list-button" (click)="openCompanyProjectFeedbackListPage()">토론하러 가기<ion-icon name="ios-arrow-forward"></ion-icon></button> -->
    </div>
    <div text-center *ngIf = "!feedbacks.length" class="empty-inner">
      <ion-icon name="text"></ion-icon>
      <p>BEST 피드백이 없습니다.</p>
    </div>
    <ion-card class="feedback-card" *ngFor="let feedback of feedbacks"> 
      <ion-card-header>
        <ion-item class="avatar-span-wrapper item-flex">
          <span item-start class="avatar-image avatar-span" tappable (click)="openCompanyProjectUserProfilePage()">
            <div class="avatar-span-image" [style.backgroundImage]="'url(' + feedback.avatar_image + ')'"></div>
          </span>
          <h3>
            <span class="best-badge" *ngIf="feedback.is_best">
              <span>BEST</span>
            </span>
            <span class="user-nickname-button" tappable (click)="openCompanyProjectUserProfilePage()">{{feedback.nickname}}</span>
            <span float-right class="empathy-wrapper">
              <span><span class="text-empathy">공감</span> {{feedback.empathy_num}}</span>
              <span><span class="text-nonempathy">비공감</span> {{feedback.non_empathy_num}}</span>
            </span>
          </h3>
          <p [innerHTML]="feedback.project_feedback_registration_date | amLocale:'ko' | amTimeAgo"></p>
        </ion-item>
      </ion-card-header>
      <ion-card-content class="feedback-content">
        <div tappable (click)="openCompanyProjectFeedbackPage(feedback.project_participant_id)">
          {{(feedback.project_feedback | jsonParse)[0] | slice:0:100}}   
          <span class="slice-tag" *ngIf="(feedback.project_feedback | jsonParse)[0].length > 100"> ...</span>  
          <div class="feedback-more-button">피드백 자세히 보러가기 ></div>
        </div>
        <div class="hashtag-wrapper">
        <span tappable ion-button outline *ngFor="let feedbackHashtag of feedback.project_feedback_hashtags | jsonParse" (click)="openCompanyProjectSearchResultPage([feedbackHashtag])" >
          #{{feedbackHashtag}}
        </span> 
        </div>
      </ion-card-content>
    </ion-card>
  </div>
  <ion-fab right bottom>
    <button ion-fab color="primary" (click)="openCompanyProjectInterviewPage()"><ion-icon name="text"></ion-icon></button>
    <ion-badge item-end *ngIf="interview_num > 0">{{interview_num}}</ion-badge>
  </ion-fab>
</ion-content> 
